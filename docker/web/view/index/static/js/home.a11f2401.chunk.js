"use strict";(self.webpackChunkyayar=self.webpackChunkyayar||[]).push([[177],{779:function(e,n,t){t.r(n);t(9545);var i=t(6701),r=t(2791),a=t(6871),s=t(184);i.Z.Header,i.Z.Sider;function o(){return(0,s.jsx)(i.Z,{children:(0,s.jsx)(a.j3,{})})}n.default=(0,r.memo)(o)},638:function(e,n,t){t.r(n),t.d(n,{default:function(){return de}});t(2011);var i=t(4904),r=(t(7668),t(1333)),a=(t(5005),t(8361)),s=(t(1638),t(3695)),o=t(5861),c=t(9439),l=(t(8071),t(6106)),u=(t(3640),t(7788)),d=(t(8717),t(914)),p=(t(8868),t(7083)),h=t(7757),f=t.n(h),x=t(2791),v=t(4771),m=t(8907),j=(t(2087),t(63)),Z=(t(326),t(5594)),g=(t(7671),t(1992)),b=t(447),y=t(7295),_=t(3119),C=t(9246),S={list:"list--mVOyT",loading_box:"loading_box--f2yge",icon:"icon--tZb7r",p_btn:"p_btn--VbDJ6",c_icon:"c_icon--T9xBi"},k=t(5671),w=t(3144),P="http://localhost:8600",O=t(6188),T=t.n(O),E=t(4098),N=function(){function e(){(0,k.Z)(this,e),this.cosConfigs={COS_BUCKET_NAME:"",COS_APP_ID:"",COS_REGION:"",COS_CDN_URL:"",COS_RES_DIR:""},(0,E.ky)(this),this.setCosConfig()}return(0,w.Z)(e,[{key:"setCosConfig",value:function(e){var n=this,t="".concat(P,"/user/cos");fetch(t,{method:"GET"}).then((function(e){return e.json()})).then((function(t){var i,r=null!==(i=t.data)&&void 0!==i?i:{};t.data&&((0,E.z)((function(){n.cosConfigs={COS_BUCKET_NAME:r.COS_BUCKET_NAME,COS_APP_ID:r.COS_APP_ID,COS_REGION:r.COS_REGION,COS_CDN_URL:r.COS_CDN_URL,COS_RES_DIR:r.COS_RES_DIR}})),e&&e(r))}))}},{key:"getCOSClient",value:function(){return new(T())({getAuthorization:function(e,n){var t="".concat(P,"/user/cos");fetch(t,{method:"GET"}).then((function(e){return e.json()})).then((function(e){var t,i,r,a,s=null!==(t=e.data)&&void 0!==t?t:{};e.data&&n({TmpSecretId:null===(i=s.Data.Credentials)||void 0===i?void 0:i.TmpSecretId,TmpSecretKey:null===(r=s.Data.Credentials)||void 0===r?void 0:r.TmpSecretKey,SecurityToken:null===(a=s.Data.Credentials)||void 0===a?void 0:a.Token,StartTime:s.Data.StartTime,ExpiredTime:s.Data.ExpiredTime})}))}})}},{key:"_uploadFile",value:function(e,n,t,i,r){this.getCOSClient().uploadFile({Bucket:"".concat(e.COS_BUCKET_NAME,"-").concat(e.COS_APP_ID),Region:e.COS_REGION,Key:n,Body:t,onProgress:function(e){i&&i(e)},onFileFinish:function(e,n,t){r&&r(e,n,t)}})}},{key:"_deleteFile",value:function(e,n){this.getCOSClient().deleteObject({Bucket:"".concat(e.COS_BUCKET_NAME,"-").concat(e.COS_APP_ID),Region:e.COS_REGION,Key:n})}},{key:"uploadFile",value:function(){var e=(0,o.Z)(f().mark((function e(n,t,i,r){var a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:""==this.cosConfigs.COS_BUCKET_NAME?this.setCosConfig((function(e){a._uploadFile(e,t,n,i,r)})):this._uploadFile(this.cosConfigs,t,n,i,r);case 1:case"end":return e.stop()}}),e,this)})));return function(n,t,i,r){return e.apply(this,arguments)}}()},{key:"deleteFile",value:function(){var e=(0,o.Z)(f().mark((function e(n){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:""==this.cosConfigs.COS_BUCKET_NAME?this.setCosConfig((function(e){t._deleteFile(e,n)})):this._deleteFile(this.cosConfigs,n);case 1:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()},{key:"appList",value:function(){var e=(0,o.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(P,"/app/list")).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"appVersions",value:function(){var e=(0,o.Z)(f().mark((function e(n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(P,"/app/versions?id=").concat(n)).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},{key:"publishApp",value:function(){var e=(0,o.Z)(f().mark((function e(n){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new FormData,Object.keys(n).map((function(e){void 0==n[e]&&null==n[e]||t.append(e,n[e])})),e.abrupt("return",fetch("".concat(P,"/app/create"),{method:"POST",body:t}).then((function(e){return e.json()})));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}]),e}(),I=new N,R=t(7892),D=t.n(R),A=t(184),F=(0,m.Pi)((function(e){var n=e.item,t=e.index,r=(0,x.useState)(!1),a=(0,c.Z)(r,2),p=a[0],h=a[1],v=(0,x.useMemo)((function(){return p?t:void 0}),[p]),m=(0,x.useState)([]),k=(0,c.Z)(m,2),w=k[0],O=k[1],T=(0,x.useCallback)((0,o.Z)(f().mark((function e(){var t,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h(t=!p),!t){e.next=13;break}return e.prev=3,e.next=6,I.appVersions(n.id);case 6:(i=e.sent).message?s.ZP.error(i.message):O(i.data),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),s.ZP.error(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[3,10]])}))),[p]);return(0,A.jsx)(i.ZP.Item,{onClick:T,className:S.item,children:(0,A.jsx)(l.Z,{style:{width:"100%"},children:(0,A.jsxs)(d.Z,{style:{width:"100%"},children:[(0,A.jsxs)(l.Z,{justify:"space-between",align:"middle",style:{width:"100%",padding:"0px 15px"},children:[(0,A.jsx)(d.Z,{children:(0,A.jsxs)(l.Z,{gutter:12,children:[(0,A.jsx)(d.Z,{children:(0,A.jsx)(g.Z,{src:n.logo,preview:!1,className:S.icon})}),(0,A.jsxs)(d.Z,{children:[(0,A.jsx)(u.Z.Title,{level:5,children:n.name}),(0,A.jsx)(u.Z.Text,{children:n.bundle_id})]})]})}),(0,A.jsx)(d.Z,{children:p?(0,A.jsx)(b.Z,{className:S.c_icon}):(0,A.jsx)(y.Z,{className:S.c_icon})})]}),(0,A.jsx)(l.Z,{style:{width:"100%"},children:(0,A.jsx)(j.Z,{ghost:!0,activeKey:v,style:{width:"100%"},children:(0,A.jsx)(j.Z.Panel,{header:"",showArrow:!1,style:{width:"100%"},children:w.map((function(e,t){var i,r,a,s=null!==(i=e.ipa_url)&&void 0!==i&&i,o=null!==(r=e.apk_url)&&void 0!==r&&r,c=D()(e.updatedAt).format("YYYY/MM/DD HH:mm:ss"),p=null!==(a=e.version)&&void 0!==a?a:"\u672a\u77e5\u7248\u672c";return(0,A.jsxs)(l.Z,{justify:"space-between",align:"middle",onClick:function(){var e="".concat(P,"/app/install/").concat(n.bundle_id,"/").concat(p);window.open(e,"_blank")},style:{backgroundColor:"#fafafc",padding:"6px 5px",marginBottom:5},children:[(0,A.jsxs)(d.Z,{children:[(0,A.jsxs)(l.Z,{children:[(0,A.jsx)(d.Z,{children:(0,A.jsx)(Z.Z,{status:"success"})}),(0,A.jsx)(d.Z,{children:(0,A.jsxs)(u.Z.Text,{children:["\u7248\u672c\u53f7",(0,A.jsx)(u.Z.Text,{type:"secondary",style:{paddingLeft:5},children:p})]})})]}),(0,A.jsxs)(l.Z,{children:[(0,A.jsx)(d.Z,{children:(0,A.jsx)(Z.Z,{status:"success",style:{opacity:0}})}),(0,A.jsx)(d.Z,{children:(0,A.jsxs)(u.Z.Text,{type:"secondary",style:{fontSize:11},children:["\u4e0a\u6b21\u66f4\u65b0 ",c]})})]})]}),(0,A.jsx)(d.Z,{children:(0,A.jsxs)(l.Z,{gutter:16,children:[(0,A.jsx)(d.Z,{children:(0,A.jsx)("div",{className:S.p_btn,style:{opacity:o?1:.38},children:(0,A.jsx)(_.Z,{style:{color:"#565657"}})})}),(0,A.jsx)(d.Z,{children:(0,A.jsx)("div",{className:S.p_btn,style:{opacity:s?1:.38},children:(0,A.jsx)(C.Z,{style:{color:"#565657"}})})})]})})]},e.id)}))},t)})})]})})})})),K=(t(4355),t(9389)),M=t(7762),B=function(){function e(){(0,k.Z)(this,e)}return(0,w.Z)(e,null,[{key:"create",value:function(e){return e}},{key:"combine",value:function(e){var n={};if(void 0===e)return n;if(Array.isArray(e)){var t,i=(0,M.Z)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=Object.assign(n,r)}}catch(a){i.e(a)}finally{i.f()}}return n}}]),e}();B.absoluteFill={position:"absolute",top:0,right:0,bottom:0,left:0};var z=function(e){e.onAddClick;return(0,A.jsx)("div",{style:U.bar,children:(0,A.jsx)("div",{style:U.bar_content,children:(0,A.jsx)("div",{style:U.bar_content_input,children:(0,A.jsx)(K.Z,{type:"text",bordered:!1,placeholder:"\u641c\u7d22\u4f60\u60f3\u4e0b\u8f7d\u7684App",style:U.input})})})})},U=B.create({bar:{width:"100vw",height:56,background:"white",position:"fixed",top:0,zIndex:1},bar_content:{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center"},bar_content_input:{display:"flex",flexGrow:1,margin:"0 15px",height:32,alignItems:"center",borderRadius:8,background:"#f8f8fa"},input:{display:"flex",border:"none",backgroundColor:"transparent",fontSize:14},close:{display:"flex",margin:"0 12px",color:"#bbb"}}),G=(t(8029),t(1561)),L=(t(8630),t(5)),q=t(6460),V=t.n(q),Y=t(1413),H=(t(5516),t(3272)),W=(t(7142),t(9553)),J=t(6776),Q=t(7106),X=t(2351),$="upload--awaWg",ee="button--wrhuV",ne="text--XpQjo",te="cover--jgu7D";function ie(e){var n="image/jpeg"===e.type||"image/png"===e.type;n||s.ZP.error("\u53ea\u5141\u8bb8\u4e0a\u4f20 JPG/PNG \u6587\u4ef6!");var t=e.size/1024/1024<2;return t||s.ZP.error("\u56fe\u7247\u5fc5\u987b\u5c0f\u4e8e 2MB!"),n&&t}var re=(0,m.Pi)((function(e){var n=e.value,t=(0,x.useState)(!1),i=(0,c.Z)(t,2),r=i[0],a=i[1],o=(0,x.useState)(e.value),l=(0,c.Z)(o,2),u=l[0],d=l[1],p=(0,x.useMemo)((function(){var e;return null!==u&&void 0!==u&&u.location?null!==u&&void 0!==u&&null!==(e=u.location)&&void 0!==e&&e.startsWith("http")?u.location:"https://"+u.location:""}),[u]);(0,x.useEffect)((function(){null!==n&&void 0!==n&&n.location&&d(n)}),[n]);var h=(0,A.jsxs)("div",{className:ee,children:[r?(0,A.jsx)(Q.Z,{}):(0,A.jsx)(X.Z,{}),(0,A.jsx)("div",{className:ne,children:"\u70b9\u51fb\u4e0a\u4f20\u5e94\u7528\u56fe\u6807"})]});return(0,A.jsx)(W.Z,{name:"logo",className:$,listType:"picture-card",accept:".jpg,.png,.jpeg",showUploadList:!1,maxCount:1,beforeUpload:ie,customRequest:function(n){a(!0);var t=n.file;I.uploadFile(t,"".concat(I.cosConfigs.COS_RES_DIR,"/tmp/").concat(t.name),(function(e){}),(function(n,t,i){if(a(!1),null==n){var r={location:t.Location,objectPath:i.Key};d(r),e.onChange&&e.onChange(r)}else s.ZP.error(n.message)}))},children:null!==u&&void 0!==u&&u.location?(0,A.jsx)("img",{className:te,src:p,alt:"cover"}):h})})),ae=W.Z.Dragger,se=(0,m.Pi)((function(e){return(0,A.jsxs)(ae,{name:"file",multiple:!1,accept:".apk,.ipa",customRequest:function(){var n=(0,o.Z)(f().mark((function n(t){var i,r,a;return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=t.onSuccess,r=t.onProgress,a=t.file,I.uploadFile(a,"".concat(I.cosConfigs.COS_RES_DIR,"/tmp/").concat(a.name),(function(e){r&&r({percent:100*e.percent})}),(function(n,t,r){if(null==n){var o={location:t.Location,objectPath:r.Key,size:a.size};i&&i(o),e.onChange&&e.onChange(o)}else s.ZP.error(n.message)}));case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),children:[(0,A.jsx)("p",{className:"ant-upload-drag-icon",children:(0,A.jsx)(J.Z,{})}),(0,A.jsx)("p",{className:"ant-upload-text",children:"\u70b9\u51fb\u6216\u62d6\u52a8\u6587\u4ef6\u5230\u8fd9\u91cc\u6765\u4e0a\u4f20\u5e94\u7528\u6587\u4ef6"}),(0,A.jsx)("p",{className:"ant-upload-hint",children:"\u4ec5\u652f\u6301\u4e0a\u4f20 .apk \u548c .ipa \u683c\u5f0f\u7684\u5e94\u7528\u6587\u4ef6\uff1b\u8bf7\u52ff\u4e0a\u4f20\u5176\u5b83\u975e\u76f8\u5173\u6587\u4ef6\uff1b"})]})}));function oe(e){return e.startsWith("http")?e:"https://"+e}var ce=(0,m.Pi)((function(e){var n=e.hide,t=e.visible,i=H.Z.useForm(),r=(0,c.Z)(i,1)[0],a=(0,x.useState)([]),o=(0,c.Z)(a,2),l=o[0],u=o[1],d=(0,x.useMemo)((function(){return l.map((function(e,n){return{label:e.bundle_id,value:e.bundle_id}}))}),[l]),p=(0,x.useState)(),h=(0,c.Z)(p,2),f=h[0],v=(h[1],(0,x.useRef)("")),m=(0,x.useRef)({}).current;return(0,x.useEffect)((function(){I.appList().then((function(e){e.message?s.ZP.error(e.message):u(e.data)})).catch((function(e){s.ZP.error(e.message)}))}),[]),(0,A.jsx)(G.Z,{visible:t,width:500,centered:!0,okText:"\u53d1\u5e03",cancelText:"\u53d6\u6d88",bodyStyle:{padding:0,margin:0,height:"80vh"},onOk:function(){r.submit()},onCancel:function(){for(var e=0,t=Object.keys(m);e<t.length;e++){var i=t[e],a=m[i];a&&I.deleteFile(a)}r.resetFields(),n()},children:(0,A.jsx)("div",{style:{height:"100%",width:"100%",overflow:"scroll"},children:(0,A.jsxs)(H.Z,{form:r,name:"publish-app",onFinish:function(t){var i,r=(null!==(i=t.access_code)&&void 0!==i?i:"").trim(),a=(0,Y.Z)((0,Y.Z)({logo:oe(t.logo.location),bundle_id:v.current},V()(t,["name","version","build"])),{},{size:t.app.size,access:""==r?"public":"private",access_code:r});-1!=t.app.location.indexOf(".apk")?a.apk_url=oe(t.app.location):a.ipa_url=oe(t.app.location),f&&(a.id=f.id);var o=s.ZP.loading("\u6b63\u5728\u53d1\u5e03\u66f4\u65b0\u4e2d\u3001\u8bf7\u52ff\u64cd\u4f5c...");I.publishApp(a).then((function(t){o(),n(),t.message?s.ZP.error(t.message):(s.ZP.success("\u53d1\u5e03\u6210\u529f"),e.onPublishSuccess&&e.onPublishSuccess())})).catch((function(e){n(),o(),s.ZP.error(e.message)}))},initialValues:{build:1},onFieldsChange:function(e,n){e.map((function(e,n){var t,i,r=e.name.toString();if(-1!=r.indexOf("app"))(null!==(t=null===(i=e.value)||void 0===i?void 0:i.objectPath)&&void 0!==t?t:"").length>0&&(m[r]=e.value.objectPath);else if(-1!=r.indexOf("logo")){var a,s;(null!==(a=null===(s=e.value)||void 0===s?void 0:s.objectPath)&&void 0!==a?a:"").length>0&&(m[r]=e.value.objectPath)}}))},labelCol:{span:4},style:{padding:"0 15px",paddingTop:50},children:[(0,A.jsx)(H.Z.Item,{name:"app",required:!0,children:(0,A.jsx)(se,{})}),(0,A.jsx)(H.Z.Item,{name:"bundle_id",label:"\u5e94\u7528\u5305\u540d",required:!0,children:(0,A.jsx)(K.Z.Group,{compact:!0,children:(0,A.jsx)(L.Z,{placeholder:"\u5e94\u7528\u7684\u552f\u4e00\u6807\u8bc6\u3001\u4f8b\u5982: com.xxx",options:d,onChange:function(e,n){var t,i,a=(0,M.Z)(l);try{for(a.s();!(i=a.n()).done;){var s=i.value;if(s.bundle_id==e){t=s;break}}}catch(o){a.e(o)}finally{a.f()}v.current=e,t&&r.setFieldsValue({name:t.name,logo:{location:t.logo,objectPath:""}})},style:{width:"100%"}})})}),(0,A.jsx)(H.Z.Item,{name:"name",label:"\u5e94\u7528\u540d\u79f0",required:!0,children:(0,A.jsx)(K.Z,{disabled:void 0!=(null===f||void 0===f?void 0:f.name)})}),(0,A.jsx)(H.Z.Item,{name:"access_code",label:"\u8bbf\u95ee\u5bc6\u7801",tooltip:"\u4e0d\u8bbe\u7f6e\u5219\u9ed8\u8ba4\u6240\u6709\u4eba\u8bbf\u95ee\u4e0b\u8f7d\u94fe\u63a5\u5747\u53ef\u76f4\u63a5\u4e0b\u8f7d",children:(0,A.jsx)(K.Z,{placeholder:"\u8bbe\u7f6eApp\u4e0b\u8f7d\u5bc6\u7801"})}),(0,A.jsx)(H.Z.Item,{name:"logo",label:"\u5e94\u7528\u56fe\u6807",required:!0,children:(0,A.jsx)(re,{})}),(0,A.jsx)(H.Z.Item,{name:"version",label:"\u7248\u672c\u53f7",required:!0,children:(0,A.jsx)(K.Z,{placeholder:"\u7248\u672c\u53f7\u3001\u4f8b\u59821.0.0",style:{width:"50%"}})}),(0,A.jsx)(H.Z.Item,{name:"build",label:"\u7f16\u8bd1\u53f7",required:!0,children:(0,A.jsx)(K.Z,{type:"number",placeholder:"\u5f53\u524d\u7248\u672c\u7b2c\u51e0\u6b21\u7f16\u8bd1",style:{width:"30%"}})})]})})})})),le=function(){return(0,A.jsxs)(l.Z,{gutter:12,align:"middle",justify:"center",className:S.loading_box,children:[(0,A.jsx)(d.Z,{children:(0,A.jsx)(p.Z,{size:"small",style:{transform:"translateY(1px)"}})}),(0,A.jsx)(d.Z,{children:(0,A.jsx)(u.Z.Text,{style:{color:"#78787a",fontSize:16},children:"\u594b\u529b\u52a0\u8f7d\u4e2d..."})})]})},ue=(0,m.Pi)((function(e){var n=(0,x.useState)(!1),t=(0,c.Z)(n,2),l=t[0],u=(t[1],(0,x.useState)(!1)),d=(0,c.Z)(u,2),p=d[0],h=d[1],m=(0,x.useState)([]),j=(0,c.Z)(m,2),Z=j[0],g=j[1],b=(0,x.useState)(!1),y=(0,c.Z)(b,2),_=y[0],C=y[1],k=function(){var e=(0,o.Z)(f().mark((function e(){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p){e.next=2;break}return e.abrupt("return");case 2:return h(!0),e.prev=3,e.next=6,I.appList();case 6:(n=e.sent).message?s.ZP.error(n.message):g(n.data),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),s.ZP.error(e.t0.message);case 13:h(!1);case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){k()}),[]),(0,x.useEffect)((function(){var e=0;window.onkeydown=function(n){_||("KeyN"==n.code?3==(e+=1)&&(e=0,C(!0)):e>0&&(e=0))}}),[_]);return p&&0==Z.length?(0,A.jsx)(le,{}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(ce,{visible:_,hide:function(){return C(!1)},onPublishSuccess:function(){k()}}),(0,A.jsxs)("div",{id:"scrollable",className:S.list,children:[(0,A.jsx)(z,{}),(0,A.jsx)(v.Z,{dataLength:Z.length,next:k,hasMore:l,loader:p&&(0,A.jsx)(a.Z,{paragraph:{rows:1},active:!0}),endMessage:(0,A.jsx)(r.Z,{plain:!0,children:"\u6ca1\u6709\u66f4\u591a\u4e86\ud83e\udd10"}),scrollableTarget:"scrollable",style:{marginTop:56},children:(0,A.jsx)(i.ZP,{dataSource:Z,renderItem:function(e,n){return(0,A.jsx)(F,{item:e,index:n})}})})]})]})})),de=ue}}]);
//# sourceMappingURL=home.a11f2401.chunk.js.map